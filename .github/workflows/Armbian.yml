name: Armbian
on:
  push:
    branches:
      - dev
jobs:
  build:
    name: Armbian
    runs-on: ubuntu-latest
    steps:
     - name: ç¼–è¯‘å¼€å§‹é€šçŸ¥
       run: |
        curl -k --data chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" --data "text=æˆ‘äº²çˆ±çš„âœ¨ä¸»äººâœ¨ï¼Œæ‚¨çš„Armbiané•œåƒå¼€å§‹ç¼–è¯‘å•¦ï¼" "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage"

     - name: ç¼–è¯‘é•œåƒ
       id: compile
       run: |
        git clone -b dev https://github.com/yunsur/phicomm-n1.git /opt/phicomm-n1
        cd /opt/phicomm-n1
        sudo ./compile.sh BOARD=arm-64 BRANCH=current RELEASE=bullseye BUILD_MINIMAL=yes BUILD_DESKTOP=no KERNEL_ONLY=no KERNEL_CONFIGURE=no COMPRESS_OUTPUTIMAGE=sha,img

     - name: æ‰“åŒ…é•œåƒ
       run: |
        xz -9ezvT0 /opt/phicomm-n1/output/images/*.img

     - name: ä¸Šä¼ é•œåƒ
       uses: actions/upload-artifact@main
       with:
         name: Armbian image
         path: /opt/phicomm-n1/output/images/

     - name: ä¸Šä¼ é•œåƒè‡³release
       uses: softprops/action-gh-release@v1
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       with:
         tag_name: $(date +"%Y.%m.%d-%H%M")
         files: |
           /opt/phicomm-n1/output/images/*.xz
           /opt/phicomm-n1/output/images/*.sha

     - name: ç¼–è¯‘æˆåŠŸé€šçŸ¥
       run: |
        curl -k --data chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" --data "text=æˆ‘äº²çˆ±çš„âœ¨ä¸»äººâœ¨ï¼Œæ‚¨çš„Armbiané•œåƒé¡ºåˆ©ç¼–è¯‘å®Œæˆå•¦ï¼ğŸ’" "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage"
